package pl.polskistevek.guard.bukkit.exploit;

import com.comphenix.protocol.PacketType;
import com.comphenix.protocol.events.PacketAdapter;
import com.comphenix.protocol.events.PacketEvent;
import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import pl.polskistevek.guard.bukkit.BukkitMain;
import pl.polskistevek.guard.bukkit.manager.UserManager;
import pl.polskistevek.guard.bukkit.object.User;

public class PacketReceivingEvent extends PacketAdapter {
    public PacketReceivingEvent(final BukkitMain plugin) {
        super(plugin, PacketType.Play.Client.LOOK);
        this.plugin = plugin;
    }

    public void onPacketReceiving(final PacketEvent event) {
        if (!BukkitMain.EXPLOIT_ENABLED) {
            return;
        }
        final Player player = event.getPlayer();
        final User user = UserManager.getUser(player);
        user.setPacketsPerSecond(user.getPacketsPerSecond() + 1);
        if (user.getPacketsPerSecond() > BukkitMain.EXPLOIT_MAX_PACKET){

        }
        Bukkit.getScheduler().runTaskLaterAsynchronously(BukkitMain.getPlugin(BukkitMain.class), new Runnable() {
            @Override
            public void run() {
                if (player.isOnline()) {
                    user.setPacketsPerSecond(user.getPacketsPerSecond() - 1);
                }
            }
        }, 20);
    }
}
